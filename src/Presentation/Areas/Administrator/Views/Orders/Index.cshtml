@model DataLayer.ViewModels.PagerViewModel.PagerViewModels<DataLayer.Models.Order>
@using MvcPager
@{ GladcherryShopping.Models.ApplicationDbContext content = new GladcherryShopping.Models.ApplicationDbContext();}
@{
    ViewBag.Title = "لیست سفارشات";
    Layout = "~/Areas/Administrator/Views/Shared/_Layout.cshtml";
}

<h2>مدیریت سفارشات</h2>

<div class="ibox-content">
    <form method="get" action="/Administrator/Orders/Index" class="form-inline mb-3">
        <input type="text" name="searchOrderId" value="@ViewBag.SearchOrderId"
               class="form-control" placeholder="🔍 شماره سفارش..."
               style="width:180px; margin-left:10px;" />

        <input type="text" name="searchUserId" value="@ViewBag.SearchUserId"
               class="form-control" placeholder="🔍 شناسه کاربر / موبایل..."
               style="width:220px; margin-left:10px;" />

        <button type="submit" class="btn btn-primary">جستجو</button>
        <a href="/Administrator/Orders/Index" class="btn btn-default">نمایش همه</a>
    </form>
</div>

<div class="ibox-content table-responsive">
    <table class="table table-bordered table-hover table-striped">
        <thead>
            <tr>
                <th># سفارش</th>
                <th>شناسه کاربر</th>
                <th>نام کاربر</th>
                <th>شماره موبایل</th>
                <th>استان</th>
                <th>شهر</th>
                <th>مبلغ (ریال)</th>
                <th>نوع سفارش</th>
                <th>نحوه پرداخت</th>
                <th>وضعیت کیف پول</th>
                <th>پرداخت مستقیم</th>
                <th>وضعیت ارسال</th>
                <th>تاریخ</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.data)
            {
                <tr>
                    <td>@item.Id</td>
                    <td>@(item.UserId ?? "مهمان")</td>
                    <td>
                        @(item.User != null
                          ? (item.User.FirstName + " " + item.User.LastName)
                          : "مهمان")
                    </td>
                    <td>@(item.User != null ? item.User.PhoneNumber : "—")</td>
                    <td>@(item.StateId != null ? content.States.Find(item.StateId)?.Name : "—")</td>
                    <td>@(item.CityId != null ? content.Cities.Find(item.CityId)?.Name : "—")</td>
                    <td><ins>@string.Format("{0:n0}", Convert.ToInt32(item.TotalPrice))</ins></td>
                    <td>@item.getType</td>
                    <td>@item.getPaymentType</td>
                    <td>@(item.Done ? "انجام شده" : "انجام نشده")</td>
                    <td>@(item.Transactions.Any() ? "انجام شده" : "انجام نشده")</td>
                    <td>@item.getSender</td>
                    <td>@GladCherryShopping.Helpers.FunctionsHelper.GetPersianDateTime(item.OrderDate, true, true)</td>
                    <td>
                        @if (item.Transactions.Any())
                        {
                            @Html.ActionLink("تراکنش", "Transaction", new { id = item.Id }, new { @class = "btn btn-primary btn-xs" }) <span>|</span>
                        }
                        @Html.ActionLink("وضعیت", "Sender", new { id = item.Id }, new { @class = "btn btn-primary btn-xs" }) |
                        @Html.ActionLink("جزییات", "Details", new { id = item.Id }, new { @class = "btn btn-info btn-xs" }) |
                        @Html.ActionLink("مالی", "Payments", new { id = item.Id }, new { @class = "btn btn-success btn-xs" }) |
                        @Html.ActionLink("لغو", "Delete", new { id = item.Id }, new { @class = "btn btn-danger btn-xs" })
                    </td>
                </tr>
            }
        </tbody>
    </table>
    <div class="row">
        <div class="col-md-6" style="direction:ltr">
            <ul class="pagination pagination-sm">
                <li>
                    @Html.Pager(
                        pageSize: 10,
                        currentPage: Model.CurrentPage,
                        totalItemCount: Model.TotalItemCount,
                        values: new { searchOrderId = ViewBag.SearchOrderId, searchUserId = ViewBag.SearchUserId }
                    )
                </li>
            </ul>
        </div>
    </div>
</div>
